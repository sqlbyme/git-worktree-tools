# Parallel Development Examples

## Scenario 1: Setting Up Multiple Agents

Create persistent worktrees for multiple Claude Code instances:

```bash
# From project root, create agent worktrees
./scripts/create-worktree.sh claude-backend
./scripts/create-worktree.sh claude-frontend
./scripts/create-worktree.sh claude-tests

# Check the registry
./scripts/list-worktrees.sh
```

Output:
```
Active Agent Worktrees
======================

Agent: claude-backend
  Path: /path/to/project-worktrees/claude-backend
  Dev Port: 8001
  Frontend Port: 3001
  Created: 2025-01-15T10:30:00Z

Agent: claude-frontend
  Path: /path/to/project-worktrees/claude-frontend
  Dev Port: 8002
  Frontend Port: 3002
  Created: 2025-01-15T10:31:00Z

Agent: claude-tests
  Path: /path/to/project-worktrees/claude-tests
  Dev Port: 8003
  Frontend Port: 3003
  Created: 2025-01-15T10:32:00Z
```

## Scenario 2: Agent Working on Multiple Tasks

A single agent handles multiple tasks sequentially:

**Task 1: Implement OAuth**
```bash
cd ../project-worktrees/claude-backend
git checkout -b feature/oauth
# ... work on OAuth ...
git push -u origin feature/oauth
gh pr create
git checkout main
git pull
```

**Task 2: Add API Caching**
```bash
# Same agent, new task
git checkout -b feature/api-caching
# ... work on caching ...
git push -u origin feature/api-caching
gh pr create
git checkout main
```

The worktree persists, so environment setup happens only once.

## Scenario 3: Human + Multiple Agents

**Human (main worktree):**
```bash
cd ~/projects/myapp
# Working on critical production fix
# Port 8000
```

**Claude Backend Agent:**
```bash
cd ../myapp-worktrees/claude-backend
git checkout -b feature/auth-api
# Working on authentication API
# Port 8001
```

**Claude Frontend Agent:**
```bash
cd ../myapp-worktrees/claude-frontend
git checkout -b feature/login-ui
# Working on login UI components
# Port 8002, Frontend 3002
```

All work independently without port conflicts.

## Scenario 4: Team Development

**Developer A (persistent worktree):**
```bash
./scripts/create-worktree.sh dev-alice
cd ../project-worktrees/dev-alice
# Alice's workspace: ports 8001/3001
```

**Developer B (persistent worktree):**
```bash
./scripts/create-worktree.sh dev-bob
cd ../project-worktrees/dev-bob
# Bob's workspace: ports 8002/3002
```

**Claude Agent (persistent worktree):**
```bash
./scripts/create-worktree.sh claude-assist
cd ../project-worktrees/claude-assist
# Claude's workspace: ports 8003/3003
```

Each has their own persistent workspace.

## Scenario 5: Port Registry in Action

The `agents.yaml` file tracks all assignments:

```yaml
# agents.yaml - Auto-generated by create-worktree.sh
agents:
  claude-backend:
    worktree_path: /home/user/project-worktrees/claude-backend
    dev_port: 8001
    frontend_port: 3001
    created: 2025-01-15T10:30:00Z
  claude-frontend:
    worktree_path: /home/user/project-worktrees/claude-frontend
    dev_port: 8002
    frontend_port: 3002
    created: 2025-01-15T10:31:00Z
  dev-alice:
    worktree_path: /home/user/project-worktrees/dev-alice
    dev_port: 8003
    frontend_port: 3003
    created: 2025-01-15T11:00:00Z
```

When `dev-alice` is removed:
```bash
./scripts/cleanup-worktree.sh dev-alice
```

The next agent gets ports 8003/3003 (reused).

## Scenario 6: Hotfix While Agents Continue Working

**Issue:** Critical bug needs immediate fix

**Create hotfix agent:**
```bash
./scripts/create-worktree.sh hotfix-urgent
cd ../project-worktrees/hotfix-urgent
git checkout -b hotfix/login-timeout
# Fix the bug
git push -u origin hotfix/login-timeout
gh pr create --label "urgent"
```

**Other agents continue working:**
- claude-backend: Still working on feature/oauth
- claude-frontend: Still working on feature/login-ui

After hotfix is merged, agents merge main:
```bash
# In each agent worktree
git checkout main
git pull
git checkout feature/current-work
git merge main
```

## Scenario 7: Experimentation with Multiple Approaches

**Approach A Agent:**
```bash
./scripts/create-worktree.sh experiment-orm
cd ../project-worktrees/experiment-orm
git checkout -b experiment/payment-orm
# Implement using SQLAlchemy ORM
```

**Approach B Agent:**
```bash
./scripts/create-worktree.sh experiment-raw
cd ../project-worktrees/experiment-raw
git checkout -b experiment/payment-raw-sql
# Implement using raw SQL
```

Compare approaches, keep the winner, cleanup the other:
```bash
./scripts/cleanup-worktree.sh experiment-raw
```

## Scenario 8: CI/CD Integration

**Main worktree (CI/CD target):**
- Always kept in working state
- CI/CD runs from main branch
- Only merged code that passes all tests

**Agent worktrees:**
- Can be in broken state during development
- Run local tests before pushing
- Push branches for PR review

```bash
# In agent worktree
tox -e test,lint,type
git push
gh pr create

# CI runs on the PR
# After approval and merge, agent continues with next task
git fetch origin
git reset --hard origin/main
```

## Best Practices from Examples

1. **Agent Naming:**
   - Use descriptive names: `claude-backend`, `dev-alice`, `hotfix-urgent`
   - Avoid generic names like `worktree-1`

2. **Port Management:**
   - Always check `.env.local` before starting servers
   - Ports are auto-assigned - no manual configuration needed
   - Use `./scripts/list-worktrees.sh` to see all assignments

3. **Task Flow:**
   - One branch per task
   - Complete and push before starting new task
   - Return to main between tasks

4. **Cleanup:**
   - Remove worktrees when agents are no longer needed
   - Ports are freed for reuse
   - Keep the registry clean

5. **Coordination:**
   - Agents work independently on different branches
   - Merge main regularly to stay current
   - Use PRs for code review before merging

## Directory Structure Example

```
myproject/                          # Main repo
myproject-worktrees/                # Agent worktrees container
├── agents.yaml                     # Port registry
├── claude-backend/                 # Backend agent
│   ├── .venv/                     # Isolated venv
│   ├── .env.local                 # Ports 8001/3001
│   └── ...                        # Project files
├── claude-frontend/                # Frontend agent
│   ├── .venv/                     # Isolated venv
│   ├── .env.local                 # Ports 8002/3002
│   └── ...                        # Project files
└── dev-alice/                      # Developer workspace
    ├── .venv/                     # Isolated venv
    ├── .env.local                 # Ports 8003/3003
    └── ...                        # Project files
```
